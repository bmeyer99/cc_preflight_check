# Task Status (DO NOT DELETE)
- **ID**: 7.1.7
- **Title**: Enhance Report with All Permission Details
- **AssignedTo**: Cody/code
- **From**: User Request
- **Priority**: Medium
- **Status**: Completed
## Details
### Requirements:
- The report must include a comprehensive list of all relevant IAM permissions evaluated by the preflight check, showing both allowed and denied actions.
- The source of these permissions will be the data processed or generated by the `iam_simulator.py`.
- The format of the permission details in the report should be clear, structured, and informative (e.g., detailing action, resource, effect/decision, and any conditions or denial reasons).
### Acceptance Criteria (AC):
- The generated report contains a section detailing all evaluated IAM permissions (allowed and denied).
- The permission details are accurate and complete based on the simulation results.
- The changes are integrated into the existing reporting mechanism in `report_generator.py`, `iam_simulator.py`, and `cli_handler.py`.
- The new section is well-formatted and easy to understand.
## Planning
- **Dependencies**: Output capabilities of `iam_simulator.py`.
- **Effort**: Medium
- **Start Date**: 2025-05-19 11:12
- **End Date**: 2025-05-19 11:16

### Detailed Plan:

**Phase 1: Modify `iam_simulator.py` to return all simulation results.**
1.  **File:** [`iam_simulator.py`](iam_simulator.py)
2.  **Function:** [`simulate_iam_permissions(iam_client, principal_arn, actions, resource_arns, context_entries)`](iam_simulator.py:114)
3.  **Changes:**
    *   Initialize an empty list `all_evaluation_results = []` before the loop that starts around line [186](iam_simulator.py:186).
    *   Inside the loop processing `response.get('EvaluationResults', [])` (around line [217](iam_simulator.py:217)), append each `eval_result` to the `all_evaluation_results` list.
    *   Modify the function's return statement (line [285](iam_simulator.py:285)) from `return all_allowed, all_failed_simulations` to `return all_allowed, all_evaluation_results`.

**Phase 2: Update `cli_handler.py` to handle the new return value.**
1.  **File:** [`cli_handler.py`](cli_handler.py)
2.  **Function:** [`main()`](cli_handler.py:52)
3.  **Changes:**
    *   Locate the call to `simulate_iam_permissions` (line [322](cli_handler.py:322)). Change the variable that captures the second item of the returned tuple from `failed_sims` to `all_simulation_results`.
        *   Current: `permissions_ok, failed_sims = simulate_iam_permissions(...)`
        *   New: `permissions_ok, all_simulation_results = simulate_iam_permissions(...)`
    *   Locate the call to `generate_pdf_report` (line [352](cli_handler.py:352)). Update the argument passed for `failed_simulations` to use the new `all_simulation_results` variable.
        *   Current: `failed_simulations=failed_sims,`
        *   New: `failed_simulations=all_simulation_results,`

**Phase 3: Modify `report_generator.py` to process and display all permission details.**
1.  **File:** [`report_generator.py`](report_generator.py)
2.  **Function:** [`generate_pdf_report(...)`](report_generator.py:125)
    *   Rename the parameter `failed_simulations` (line [134](report_generator.py:134)) to `all_simulation_results`.
3.  **Function:** [`_generate_html_content(...)`](report_generator.py:263)
    *   Rename the parameter `failed_simulations` (line [272](report_generator.py:272)) to `all_simulation_results`.
    *   Modify the "Deploying Principal IAM Simulation" table generation logic (currently lines [519-554](report_generator.py:519-554)):
        *   Iterate through each `result` in the `all_simulation_results` list.
        *   For each `result`:
            *   Extract `action = result.get('EvalActionName', 'Unknown')`.
            *   Extract `resource = result.get('EvalResourceName', '*')`.
            *   Extract `decision = result.get('EvalDecision', 'Unknown')`.
            *   Set `status_text = "PASS"` and `status_class = "status-green"` if `decision == "allowed"`.
            *   Set `status_text = "FAIL"` and `status_class = "status-red"` if `decision != "allowed"`.
            *   Construct `details`:
                *   If `decision == "allowed"`, `details = "Allowed"`.
                *   If `decision != "allowed"`, concatenate `decision` with reasons from `OrganizationsDecisionDetail` and `PermissionsBoundaryDecisionDetail` if present.
            *   Generate the HTML table row accordingly.
        *   Adjust or remove the conditional logic around lines [543-554](report_generator.py:543-554) as the new loop will cover these cases.

## Documentation
### Outcome/Summary:
Successfully modified `iam_simulator.py` to return all IAM simulation results (allowed and denied).
Updated `cli_handler.py` to receive and pass these comprehensive results to the report generator.
Enhanced `report_generator.py` to process and display all simulation results in the HTML/PDF report, providing a complete view of permission checks.
The report now clearly indicates PASS/FAIL for each simulated action and includes details for any denials.
### Issues/Blockers:
None.
### Files:
- [`report_generator.py`](report_generator.py)
- [`iam_simulator.py`](iam_simulator.py)
- [`cli_handler.py`](cli_handler.py)